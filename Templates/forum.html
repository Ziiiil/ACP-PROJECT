{% extends "base.html" %}
{% block content %}

<h2>Community Forum</h2>

<a href="{{ url_for('forum.add_post') }}" class="button"
   style="background-color:#007BFF; color:white; padding:8px 16px;
          border-radius:5px; text-decoration:none;">
    Create New Post
</a>

<hr>

{% if posts %}
    {% for p in posts %}
        <div class="card"
             style="padding:15px; margin-bottom:20px; border:1px solid #ddd;
                    border-radius:8px; background-color:#f9f9f9;">

            <h3>{{ p.title }}</h3>
            <p><b>By:</b> {{ p.username }}</p>
            <p>{{ p.content }}</p>

            
            <div style="margin-top:10px; display:flex; gap:10px;">
                <a href="{{ url_for('forum.edit_forum', post_id=p.id) }}"
                style="background:#28a745; padding:6px 12px; color:white; border-radius:5px; text-decoration:none;">
                    Edit
                </a>

                <form action="{{ url_for('forum.delete_forum', post_id=p.id) }}" method="POST"
                    onsubmit="return confirm('Are you sure you want to delete this post?');">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button style="background:#dc3545; padding:6px 12px; border:none; color:white; border-radius:5px;">
                        Delete
                    </button>
                </form>
            </div>

            
            <div class="comments"
                 style="margin-top:15px; padding-top:10px; border-top:1px solid #ccc;">
                <h4>Comments:</h4>

                <ul style="list-style-type:none; padding-left:0;">
                    {% for comment in p.comments %}
                        <li style="margin-bottom:10px; padding:5px;
                                   background-color:#eef6ff; border-radius:5px;">
                            <strong>{{ comment.username }}</strong>: {{ comment.content }}

                            <div style="margin-top:5px;">
                                <a href="{{ url_for('forum.edit_comment', comment_id=comment.id) }}"
                                style="font-size:12px; margin-right:10px; color:#28a745;">
                                    Edit
                                </a>

                                <form action="{{ url_for('forum.delete_comment', comment_id=comment.id) }}"
                                    method="POST" style="display:inline;"
                                    onsubmit="return confirm('Delete comment?');">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button style="font-size:12px; color:#dc3545; background:none; border:none; cursor:pointer;">
                                        Delete
                                    </button>
                                </form>
                            </div>
                        </li>
                    {% else %}
                        <li>No comments yet.</li>
                    {% endfor %}
                </ul>
            </div>

          
            <div class="add-comment" style="margin-top:10px;">

                <form action="{{ url_for('forum.add_comment', post_id=p.id) }}"
                      method="POST"
                      style="display:flex; flex-direction:column; gap:8px;">

                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                    <input type="text" name="username" placeholder="Your name" required
                           style="padding:8px; border-radius:5px; border:1px solid #ccc;">

                    <textarea name="content" placeholder="Write a comment..." required
                              style="padding:8px; border-radius:5px; border:1px solid #ccc;"></textarea>

                    <button type="submit"
                            style="background-color:#007BFF; color:white;
                                   border:none; padding:8px 16px;
                                   border-radius:5px; cursor:pointer;">
                        Add Comment
                    </button>
                </form>

            </div>

        </div>
    {% endfor %}
{% else %}
    <p>No posts yet. Be the first to share!</p>
{% endif %}

{% endblock %}
